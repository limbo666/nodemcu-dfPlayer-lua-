var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

var loginRefresh = true;
function IsPC()  
{  
   var userAgentInfo = navigator.userAgent;  
   var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");  
   var flag = true;
   for (var v = 0; v < Agents.length; v++) {  
	   if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }  
   }  
   return flag;  
}
$(window).scroll(function(){
	if($(window).scrollTop()>300){
		$(".totop_button").slideDown(200);
	}else{
		$(".totop_button").slideUp(200);
		$(".to_report_post_btn").fadeIn(200);
	}
	
	if($(window).width()<768)
	{
		if($(window).scrollTop()>190){
			$(".top-hide").addClass("collapse");
			$(".in-phone-style").css("margin-top",65);	
		}
	}
	else
	{
		$(".in-phone-style").css("margin-top",0);
	}
});

(function($){
	$.new_forum_item = {
		send_pm: function(o){
			var o = $(o);
			if(o.hasClass("active")){return false;};
			var customer_id = o.parent().attr('userid');
			if(!$("#islogin").val()){
		      //alert('Please login or register!');
		      login();
		      return false;
	           }
            if(customer_id == ''){
				return false;
			}
			if(o.hasClass("active")){return false;};
			o.addClass("active");
			var username = o.parents(".user-info-box").find(".name").html();
			
			modal_bg();
			var msg_text='' +
				'<div class="modal_msgbox">'+
					'<div class="modal_title">'+lf_send_message+'<i onclick="modal_remove();">×</i></div>'+
					'<div class="modal_msgbox_msg">'+
						'<ul class="sendmsg">'+
							'<li><span>'+lf_move_to+':</span><strong>'+username+'</strong><input id="sd_uid" type="hidden" value="'+customer_id+'" name="uid"></li>'+
							'<li><span>'+lf_subject+':</span><input id="sd_subject" class="msg_input form-control" type="text" msg="'+lf_field_required+'" value="" name="subject"></li>'+
							'<li><span>'+lf_message+':</span><textarea id="sd_content" class="msg_textarea form-control" msg2="'+lf_post_content_too_short+'" msg="'+lf_field_required+'" name="content"></textarea></li>'+
						'</ul>'+
					'</div>'+
					'<div class="modal_msgbox_button">'+
						'<span onclick="forumSendMessage()" class="button_yes">'+lc_ok+'</span>'+
					'</div>'+
				'</div>'
			$('.modal_container').append(msg_text);
			modal_add();
			setTimeout(function(){
				o.removeClass("active");
			},500);
		},
		
		send_tip_post: function(o){
			if(o.hasClass("active")){return false;};
			o.addClass("active");
			var homeUrl = '';
			var customer_id = o.attr('id');
			var username = o.parents(".topic-detail-box").find(".name").html();
			
			modal_bg();
			o.removeClass("active");
			var msg_text='' +
				'<div class="modal_msgbox">'+
					'<div class="modal_title">'+lf_send_bg_points+'<i onclick="modal_remove();">×</i></div>'+
					'<div class="modal_msgbox_msg">'+
						'<ul class="sendmsg sendpoints">'+
							'<li><span>'+lf_move_to+':</span><strong>'+username+'</strong><input id="send_id" type="hidden" value="'+customer_id+'"></li>'+
							'<li><span>'+lf_points_to_send+'</span><input id="point_amount" class="point_input form-control" type="text" msg="'+lf_please_input_integer+'" msg2="'+lf_have_not_enough_points+'"></li>'+
							'<li><span>'+lf_personal_notes+'</span><select id="#points_reason" class="form-control" value="blank"><option value="0">'+lf_blank+'</option></select></li>'+
						'</ul>'+
					'</div>'+
					'<div class="modal_msgbox_button">'+
						'<span onclick="send_points()" class="button_yes">'+lc_ok+'</span>'+
					'</div>'+
				'</div>'
			$('.modal_container').append(msg_text);
			modal_add();
		},
		
		send_report_post: function(o){
			if(o.hasClass("active")){return false;};
			o.addClass("active");
			var homeUrl = '';
			var customer_id = o.attr('id');
			
			modal_bg();
			
			var msg_text='' +
				'<div class="modal_msgbox">'+
					'<div class="modal_title">'+lf_report_a_post+'<i onclick="modal_remove();">×</i></div>'+
					'<div class="modal_msgbox_msg">'+
						'<ul class="sendmsg sendreport">'+
							'<li>'+lf_violation+'</li>'+
							'<li>'+
								'<dl class="report_select">'+
									'<dd id="1">'+lf_advertising+'</dd>'+
									'<dd id="2">'+lf_linking+'</dd>'+
									'<dd id="3">'+lf_spam+'</dd>'+
									'<dd id="4">'+lf_harassment+'</dd>'+
									'<dd id="5">'+lf_false_claim_information+'</dd>'+
									'<dd id="6">'+lf_deceptive+'</dd>'+
									'<dd id="7">'+lf_other_please_specify+'</dd>'+
								'</dl>'+
							'</li>'+
							'<li><input type="text" name="ireason" id="ireason" class="report_input form-control" msg="'+lf_please_select_item+'"></li>'+
							'<input id="ireason_id" type="hidden" value="0" name="ireason_id"><input id="report_type" type="hidden" value="post"><input id="report_pid" type="hidden" value="'+customer_id+'">'+
						'</ul>'+
					'</div>'+
					'<div class="modal_msgbox_button">'+
						'<span onclick="sendreport()" class="button_yes">'+lc_ok+'</span>'+
					'</div>'+
				'</div>'
			$('.modal_container').append(msg_text);
			modal_add();
			setTimeout(function(){
				o.removeClass("active");
			},500);
			
		},
		
		select_report: function(o){
			var val = o.text();
			id = o.attr("id");
			$("#ireason_id").val(id);
			$("#ireason").val(val);
		},
		
		format_amount: function(o){
			var val = o.val();
			if(val.length == 1){
				o.val(val.replace(/[^1-9]/g,''));
			}else{			
				o.val(val.replace(/[^0-9]/g,''));
			}
		},
		
		remove_tips: function(o){
			o.find("label").remove();
		},
		
		go_to_reply: function(o){
			$('html,body').animate({scrollTop:$(".reply-topic-box").offset().top},300);
		},
		
		subcribe_post: function(o){
			if(o.hasClass("active")){return false;};
			o.addClass("active");
			var id = o.attr("id");
			modal_bg();
			
			var msg_text='' +
				'<div class="modal_msgbox ss">'+
					'<div class="modal_msgbox_msg">'+
						'<b class="success">'+lf_subcribe+'?</b><input id="sub_topic" type="hidden" value="'+id+'" name="topic_id"><input id="fg" type="hidden" value="1" name="fg">'+
					'</div>'+
					'<div class="modal_msgbox_button">'+
						'<span onclick="forumSubcribe()" class="button_yes">'+lp_yes+'</span><span onclick="modal_remove()" class="button_no">No</span>'+
					'</div>'+
				'</div>'
			$('.modal_container').append(msg_text);
			modal_add();
			setTimeout(function(){
				o.removeClass("active");
			},1000);
		},
		
		unsubcribe_post: function(o){
			if(o.hasClass("active")){return false;};
			o.addClass("active");
			
			var id = o.attr("id");
            var tips = o.attr("data-tips");
            var is_author = $("#is_author").val();
			modal_bg();
			var msg_text='' +
				'<div class="modal_msgbox">'+
					'<div class="modal_msgbox_msg">'+
						'<b class="success">'+(is_author ? tips : lf_unsubcribe+'?') +'</b><input id="sub_topic" type="hidden" value="'+id+'" name="topic_id"><input id="fg" type="hidden" value="0" name="fg">'+
					'</div>'+
					'<div class="modal_msgbox_button">'+
						'<span onclick="forumUnsubcribe()" class="button_yes">'+lp_yes+'</span><span onclick="modal_remove()" class="button_no">No</span>'+
					'</div>'+
				'</div>'
			$('.modal_container').append(msg_text);
			modal_add();
			setTimeout(function(){
				o.removeClass("active");
			},1000);
		},
		
		in_phone_style: function(o){
			if(!o.parent().next().hasClass("in")){
				$(".in-phone-style").css("margin-top",65);	
			}
		},
        
        goToPage: function (o){
            var page = o.parent(".input-group-btn").siblings(".form-control").val();
            console.log(page);
            var r = /^[1-9]*[1-9][0-9]*$/;
             if(!r.test(page)){
                $(this).val(1);
             }
            page = page>0 ? page : 1;
            if($("#list_fid").length > 0){
                var fid = $("#list_fid").val();
                window.location.href="forum-topic-" + fid + ".html?page=" + page;
            }else{
                window.location.href="forum_unreply.html?page=" + page;
            }
        },
        
        goToPageForList: function (o){
            var page = o.parent(".input-group-btn").siblings(".form-control").val();
            console.log(page);
            var r = /^[1-9]*[1-9][0-9]*$/;
             if(!r.test(page)){
                $(this).val(1);
             }
            page = page>0 ? page : 1;
            if($("#list_fid").length > 0){
                var fid = $("#list_fid").val();
                var pid = $("#list_pid").val();
                if(pid){
                    window.location.href="forum-f-" + fid + ".html?pid="+pid+"&page=" + page;
                }else{
                    window.location.href="forum-f-" + fid + ".html?page=" + page;
                }
            }else{
                window.location.href="forum_unreply.html?page=" + page;
            }
        }
		
	}
})(jQuery);

$(document)
.on("click", ".user-info-box .other li a", function(){
	$.new_forum_item.send_pm($(this));												   
})
.on("click", ".post-reply-tool .tip-post", function(){
	$.new_forum_item.send_tip_post($(this));												   
})
.on("click", ".post-reply-tool .report-post", function(){
	$.new_forum_item.send_report_post($(this));												   
})
.on("click", ".sendreport dd", function(){
	$.new_forum_item.select_report($(this));												   
})
.on("keyup", "input[id='point_amount']", function(){
	$.new_forum_item.format_amount($(this));												   
})
.on("click", ".request-box li .input-box", function(){
	$.new_forum_item.remove_tips($(this));												   
})
.on("click", ".go-to-reply", function(){
	$.new_forum_item.go_to_reply($(this));												   
})
.on("click", ".subcribe", function(){
	$.new_forum_item.subcribe_post($(this));												   
})
.on("click", ".unsubcribe", function(){
	$.new_forum_item.unsubcribe_post($(this));												   
})
.on("click", ".navbar-inverse .navbar-toggle", function(){
	$.new_forum_item.in_phone_style($(this));												   
})
.on("click", "#pageDetailBtn", function(){
	$.new_forum_item.goToPage($(this));												   
})
.on("click", "#pageBtn", function(){
	$.new_forum_item.goToPageForList($(this));												   
})

function forumSubcribe(){
	if($(".button_yes").hasClass("loading")){return false;}
	var topic_id = $("#topic_id").val();
    var fg = $("#fg").val();
    var subcribeStatusObj = $(".topic-list-box #"+topic_id);
    var undersubscribe = $("#under_"+topic_id);
	console.log(undersubscribe);
	$(".button_yes").addClass("loading");
	setTimeout(function(){
		modal_remove();
		modal_bg();
		var success_text='' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+laf_subscribe_success+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes">'+lc_ok+'</span>'+
				'</div>'+
			'</div>';
        $.ajax({
            url:homeUrl+'index.php',
            timeout : 10000,
            type : 'post',
            data :'com=ajaxforum&t=doSubcribe&topic_id=' + topic_id + '&fg=' + fg,
            dataType:'json',
            success:function(res){
                if(!res.error){
                    $('.modal_container').append(success_text);
                    modal_add();
                    if(subcribeStatusObj.hasClass("subcribe")){
                        subcribeStatusObj.removeClass("subcribe");
                        subcribeStatusObj.addClass("unsubcribe");
                        subcribeStatusObj.text(lf_unsubcribe);
                    }
                    if(undersubscribe.hasClass("subcribe")){
                        undersubscribe.removeClass("subcribe");
                        undersubscribe.addClass("unsubcribe");
                        undersubscribe.text(lf_unsubcribe);
                    }
                    
                }else{
                    modal_remove();
                }	
			} 
        });
		//$('.modal_container').append(success_text);
		//modal_add();
	},2000);
}

function forumUnsubcribe(){
	if($(".button_yes").hasClass("loading")){return false;}
	var topic_id = $("#topic_id").val();
    var fg = $("#fg").val();
    var subcribeStatusObj = $(".topic-list-box #"+topic_id);
	var underunsubscribe = $("#under_"+topic_id);
    console.log(underunsubscribe);
	$(".button_yes").addClass("loading");
	setTimeout(function(){
		modal_remove();
		modal_bg();
        var success_text='' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+laf_unsubscribe_success+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes">'+lc_ok+'</span>'+
				'</div>'+
			'</div>';
        $.ajax({
            url:homeUrl+'index.php',
            timeout : 10000,
            type : 'post',
            data :'com=ajaxforum&t=doSubcribe&topic_id=' + topic_id + '&fg=' + fg,
            dataType:'json',
            success:function(res){
                if(!res.error){
                    $('.modal_container').append(success_text);
                    modal_add();
                    if(subcribeStatusObj.hasClass("unsubcribe")){
                        
                        subcribeStatusObj.removeClass("unsubcribe");
                        subcribeStatusObj.addClass("subcribe");
                        subcribeStatusObj.text(lf_subcribe);
                    }
                   
                    if(underunsubscribe.hasClass("unsubcribe")){
                        
                        underunsubscribe.removeClass("unsubcribe");
                        underunsubscribe.addClass("subcribe");
                        underunsubscribe.text(lf_subcribe);
                    }
                    
                }	
			} 
        });
		//$('.modal_container').append(success_text);
		//modal_add();
	},2000);
}


function forumSendMessage(){
	if($(".button_yes").hasClass("loading")){return false;}
	if($("#sd_subject").hasClass("bbs-background-color") || $("#sd_content").hasClass("bbs-background-color")){return false;}
	var receive_id = $("#sd_uid").val();
	var subject = $("#sd_subject").val();
	var content = $('#sd_content').val();
	var err_flag = false;
	if(!subject){
		err_flag = true;
	   $("#sd_subject").addClass("bbs-shake bbs-animated bbs-background-color");
	    var msg = $("#sd_subject").attr("msg");
		var msg_sub = "";
	   $("#sd_subject").val(msg);
	   setTimeout(function(){
		 $("#sd_subject").removeClass("bbs-shake bbs-animated bbs-background-color");
		  $("#sd_subject").val(msg_sub);
		},2000);
	}
	if(!content) {
        err_flag = true;
		var msg = $('#sd_content').attr("msg");
		var msg_cont = "";
		$('#sd_content').addClass("bbs-shake bbs-animated bbs-background-color");
		$("#sd_content").val(msg);
		 setTimeout(function(){
		 $("#sd_content").removeClass("bbs-shake bbs-animated bbs-background-color");
		 $("#sd_content").val(msg_cont);
		},2000);
	}
	if(content.length < 10 && content) {
		err_flag = true;
		var msg = $('#sd_content').val();
		var msg_cont2 = $('#sd_content').attr("msg2");
		$('#sd_content').addClass("bbs-shake bbs-animated bbs-background-color");
		$("#sd_content").val(msg_cont2);
		 setTimeout(function(){
		 $("#sd_content").removeClass("bbs-shake bbs-animated bbs-background-color");
		 $("#sd_content").val(msg);
		},2000);
	}
	
	if(err_flag){
	    return false;
	}
	$(".button_yes").addClass("loading");
    $.ajax({
		type: 'post',
		url:  'index.php',
		data: {'com':'ajaxforum','t':'doMessage','receive_id':receive_id,'subject':subject,'content':content},
		success:function(res){
			if(confirm(res)){
			    modal_remove();
		    }
		}
		
	});
	setTimeout(function(){
        var msgNumber = $(".nav-pm .badge").text();
        if (msgNumber == ''){
            msgNumber = 0;
        }
		modal_remove();
		modal_bg();
		var success_text='' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+lf_send_message+la_referrals_success+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes">'+lc_ok+'</span>'+
				'</div>'+
			'</div>';	
		$('.modal_container').append(success_text);
		modal_add();
		//$(".nav-pm .badge").text(parseInt(msgNumber)+1);
	},2000);
}

function send_points(){
	if($(".button_yes").hasClass("loading")){return false;}
	if($("#point_amount").hasClass("bbs-background-color")){return false;}
	var amount = $('#point_amount').val();
	var err_flag = false;
	if(!amount){
		err_flag = true;
		var msg_sub = "";
		var msg = $('#point_amount').attr("msg");
		var msg2 = $('#point_amount').attr("msg2");
		$('#point_amount').addClass("bbs-shake bbs-animated bbs-background-color");
		$("#point_amount").val(msg);
		 setTimeout(function(){
			 $("#point_amount").removeClass("bbs-shake bbs-animated bbs-background-color");
			 $("#point_amount").val(msg_sub);
		},2000);
	}
	if(err_flag){
	    return false;
	}
	$(".button_yes").addClass("loading");
	setTimeout(function(){
		modal_remove();
		modal_bg();
		var success_text='' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+la_referrals_success+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes">'+lc_ok+'</span>'+
				'</div>'+
			'</div>'
		$('.modal_container').append(success_text);
		modal_add();
	},2000);
}

function sendreport(){
	if($(".button_yes").hasClass("loading")){return false;}
	if($("#ireason").hasClass("bbs-background-color")){return false;}
	var val = $('#ireason').val();
	var err_flag = false;
	if(!val){
		err_flag = true;
		var msg_sub = "";
		var msg = $('#ireason').attr("msg");
		$('#ireason').addClass("bbs-shake bbs-animated bbs-background-color");
		$("#ireason").val(msg);
		 setTimeout(function(){
			 $("#ireason").removeClass("bbs-shake bbs-animated bbs-background-color");
			 $("#ireason").val(msg_sub);
		},2000);
	}
	if(err_flag){
	    return false;
	}
	$(".button_yes").addClass("loading");
	setTimeout(function(){
		modal_remove();
		modal_bg();
		var success_text='' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+laf_report_success+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes">'+lc_ok+'</span>'+
				'</div>'+
			'</div>'
		$('.modal_container').append(success_text);
		modal_add();
	},2000);
}

function submitRequest(form){
	$(form).find(".input-box label").remove();
	if($(form).find("button").hasClass("loading")){return false;}
	var bError = false;
	var msg = $(form).find("input").attr("msg");
	var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	var price_reg = /^[1-9]+(.[0-9]+)?$/;
	var url_reg =/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/;
	var email = $("#pr_email").val();
	var emailmsg = $(form).find("#pr_email").attr("emailmsg");
	var price = $("#pr_price").val();
	var pricemsg = $(form).find("#pr_price").attr("pricemsg");
	var product_url_msg = $(form).find("#pr_url").attr("urlmsg");
    var product_url = $("#pr_url").val();
	
	$(form).find("input").each(function(){
		var val = $(this).val();
		
		if(!val || val == 0)
		{
			bError = true;
			$(this).parents(".input-box").append('<label>'+ msg +'</label>');
		}
	});
	
	if(email.length>0)
	{
		var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
		 if(!myreg.test(email)){
			bError = true;
			$("#pr_email").parents(".input-box").append('<label>'+ emailmsg +'</label>');
		}
	}
	if(price.length>0)
	{
		if(!price_reg.test(price))
		{
			bError = true;
			$("#pr_price").parents(".input-box").append('<label>'+ pricemsg +'</label>')
		}
	}
	if(product_url.length>0)
	{
		if(!url_reg.test(product_url)){
			bError = true;
			$("#pr_url").parents(".input-box").append('<label>'+ product_url_msg +'</label>')
		}
	}
	
	if(bError) 
	{
		return false;
	}
	$(form).find("button").addClass("loading");
	
	/*setTimeout(function(){
		window.location.href='product_request.html';
	},500);*/
	
	/*$.ajax({
		type: 'POST',
		dataType: 'json',
		data: data,
		url: 'index.php',
		success: function(res) {
			$(form).find("button").removeClass("loading");
		}
	});*/
	
	/*return false;*/
}



$(".totop_button").click(function(){
	$("html,body").animate({ scrollTop:0});
});

$(".topic-post-content .select").each(function(){
	var _this = $(this);
	_this.find(".select_text").click(function(event){
		if($(this).next().is(":hidden"))
		 {
			$(this).next().show();
		 }
		 else
		 {
			$(this).next().hide();
		 }
		$("body").one("click",function(){
			$(".topic-post-content .select .select_box").hide();
		});
		event.stopPropagation();
		$(this).parents(".select").siblings().find(".select_box").hide();										
	});
	
	_this.find("li").click(function(){
		var cid = $(this).attr("cid");
		var text = $(this).text();
		$(this).parents(".select").find(".text").html(text);
		$(this).parents(".select_box").next().val(cid);
		$(this).parents(".select_box").hide();
	});
});

$('#post_topic').click(function () {
 
    var p_title = $('#post-title').val();
    //var p_title = $('#post-title').val().split(/\s+/);
    var categories_id = $("#categories_id").val();
    
    if (!$('#post-content').length) {
        forumErrors(lf_submit_review_error4,0);
        //alert('Please login first!')
        return false;
    } else if (p_title.length < 10) {
        forumErrors(lf_post_title_required,0);
        //alert('the post title is required!')
        return false;
    }
   
    if($(window).width()>999)
    {editor.sync();}
    else{}
   
    var p_content = $('#post-content').val();
    //var p_content = $('#post-content').val().split(/\s+/);

    if (p_content.length < 5) {
        console.log(p_content);
        forumErrors(lf_post_content_too_short,0);
        //alert('The content is too short222!')
        return false;
    }

    var fid = $('#forum_id').val();
    var pid = $('#products_id').val();
    var fname = $('#forum_name').html();
    


    $.ajax({
        type: 'post',
        url: 'index.php',
        data: {
            'com': 'ajaxforum',
            't': 'submitTopic',
            'title': p_title,
            'fid': fid,
            'pid': pid,
            'fname': fname,
            'content': p_content,
            'categories_id': categories_id
        },
        dataType: 'json',
        beforeSend: function () {
            $('#post_topic').attr('disabled', 'disabled');
            $('.huanchong').css('visibility', 'visible');
        },
        success: function (res) {
            $('.huanchong').css('visibility', 'hidden');
            if (!res.success) {
                //alert(res.message);
                forumErrors(res.message,0);               
            } else {
                //alert(res.message);
                var locationUrl = homeUrl + 'forum-topic-' + res.tid + '.html';
                forumErrors(res.message,locationUrl);
                //window.location.href = homeUrl + 'forum-topic-' + res.tid + '.html';
            }

        },
        complete: function () {
            $('#post_topic').removeAttr('disabled');
        }
    });


});

$('#post_reply').click(function(){
		var p_title= $('#post-title').val();
        //var p_title = $('#post-title').val().split(/\s+/);
        var _this = $(this);
		if($(this).hasClass("loading"))return;
		if(!$('#post-content').length){
			$(this).addClass("loading");
			forumErrors(lf_submit_review_error4,0);
			setTimeout(function(){
				_this.removeClass("loading");
			},500);
			return false;
		}
		else if(p_title.length<5){
			$(this).addClass("loading");
			forumErrors(lf_post_title_required,0);
			setTimeout(function(){
				_this.removeClass("loading");
			},500);
			return false;
		}
		
		if($(window).width()>999)
            {editor.sync();}
            else{}
		var p_content = $('#post-content').val();
        //var p_content = $('#post-content').val().split(/\s+/);
		if(p_content.length<10){
			$(this).addClass("loading");
			forumErrors(lf_post_content_too_short,0);
			setTimeout(function(){
				_this.removeClass("loading");
			},500);
			return false;
		}

		var p_title= $('#post-title').val();
			
		var tid = $('#topic_id').val();
		var fid = $('#forum_id').val();
		var iid = $('#iid').val();
		var vid = $('#vid').val();
		var email_uid = $("#email_uid").val();
        var page_total = $('#num_total').val();
		
		$(this).addClass("loading");
		$.ajax({
			beforeSend: function(){
				$('#post_reply').attr('disabled','disabled');
				$('.huanchong').css('visibility','visible');
			},
			type: 'post',
			url:  'index.php',
			data: {'com':'ajaxforum','t':'submitPost','title':p_title,'content':p_content,'fid':fid,'tid':tid,'iid':iid,'vid':vid,'email_uid':email_uid},
			dataType:'json',
			success:function(res){
				$('.huanchong').css('visibility','hidden');
				if(!res.success){
					//alert(res.message);
                    forumErrors(res.message,0);
				}else{
					//alert(res.message);
                    var locationUrl = homeUrl + 'forum-topic-' + tid + '.html?page='+page_total;
                    forumErrors(res.message,locationUrl);
                    //forumErrors(res.message);
					//window.setTimeout("location.reload()",100);
				}
			},
			complete: function(){
				$('#post_reply').removeAttr('disabled');
				$('#post_reply').removeClass("loading");
			}
		});
		
	});



/*var  url = 0;*/
	
function forumErrors(error,url){
	
    tips_content = '' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+error+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span onclick="modal_remove()" class="button_yes" code="1">'+lc_ok+'</span>'+
				'</div>'+
			'</div>';
    
    
    if (url != 0){
        tips_content = '' +
			'<div class="modal_msgbox">'+
				'<div class="modal_msgbox_msg">'+
					'<b class="success">'+error+'</b>'+
				'</div>'+
				'<div class="modal_msgbox_button">'+
					'<span class="button_yes" code="0">'+lc_ok+'</span>'+
				'</div>'+
			'</div>';
    }
    
    modal_bg();
    $('.modal_container').append(tips_content);
    modal_add();
    
    if (url != 0){
        $(".button_yes").click(function(){
	       window.location.href= url;
        });
        
    }
}


$('.post-reply-tool .quote').click(function(){
	var _this = $(this);
	if(_this.hasClass("loading_quote"))return;
	if($(this).hasClass('sd_email')){
		var email_uid = $(this).attr('uid');
		$("#email_uid").val(email_uid);
	}
	if($(this).parents(".container").next().find(".ke-container").length==0){
		AjaxEditor('/templates/black/kindeditor/','#post-content');	
	}
	var html = $(this).parents(".post-reply-tool").siblings(".post-text").html();
	
    var time = $(this).parents(".post-reply-tool").siblings(".post-time").children("i").html();
	var quote_title = $(this).attr('author');
    $(this).addClass("loading_quote");
    setTimeout(function(){
    	_this.removeClass("loading_quote");
    },2000);
	setTimeout(function () {
			editor.appendHtml('<blockquote><fieldset style="margin: 10px 20px; border: 2px solid rgb(215, 215, 215);"><legend><b class="blockquote_title">Quote: <\/b><i><b>' + quote_title + '</b> ' + time + '</i><\/legend>'+html+'<\/fieldset><\/blockquote><p></p>');
		}, 2500);
	
});

//search page
$("#sch_btn").click(function(){
	var page = $(".input-group .form-control").val(); 
    page = page>0 ? page : 1;
	var url = $("#search_base").val();
	window.location.href = url + "&page=" + page;
});

function _GET(a, b) {
	var c = new RegExp("[?&]" + a + "=([^&]+)", "g");
	//b = b || location.search;
	for (var d, e = ""; null !== (d = c.exec(b));) e = d[1];
	return e
}

function getDiscussion(page){
	var products_id = $('#products_id').val();
	var products_url = $('#products_url').val();
	var utm_medium = _GET('utm_medium', window.location.href);
	var utm_source = _GET('utm_source', window.location.href);
	var data = 'utm_medium='+utm_medium;
	data += '&lang='+$.cookie('_bgLang');
	data += '&utm_source='+utm_source;
        
        var topic_id = $('#topic_id').val();
        data += '&topic_id='+topic_id;
	
	$.ajax({
		url:homeUrl+'discussion-'+products_id+'-'+page+'.html',
		type : 'get',
		data :data,
		dataType:'html',
		success:function(html){
			html = '<h4>'+lf_last_post+'</h4>'+html;
			if (products_url && products_url!=''){
				html += '<a class="btn  btn-success my-bbs-color" role="button" rel="nofollow" href="' + products_url + '">Back to Product Page</a>';
			}
			$('#related-posts').html(html);
			$('#post_new_topic').remove();
		}
	});
}
function loadLangNavs()
{
	var products_id = $('#products_id').val();
	
	$.ajax({
		url:homeUrl+'index.php',
		type : 'get',
		data :'com=index&products_id='+products_id+'&t=loadLangNavs&url='+encodeURIComponent(window.location.href),
		dataType:'html',
		success:function(html){
			$('.top .language').replaceWith(html);
		}   
	});
}
loadLangNavs();
function clickLang(obj)
{
	var code = $(obj).attr('code');
	$.cookie("_bgLang", code, { expires: 7, path: '/' });
	return true;
}

//moveTopic 的弹出层(view)
$(".moveTopic").click(function(){
    var tid = $(this).attr('tid');
    var tfid = $(this).attr('tfid');

	var homeUrl = '';
	modal_bg();
	var ajaxTimeoutTest = $.ajax({
		url:homeUrl+'index.php',
		timeout : 10000,
		type : 'get',
		data : 'com=ajaxforum&t=moveTopicView&tid=' + tid + '&tfid=' + tfid,
		dataType:'html',
		success:function(html){
            $('.modal_container').append(html);
            modal_add();
		},
		complete:function(XMLHttpRequest,status){
			if(status=='timeout'){
				ajaxTimeoutTest.abort();
				console.log("Timeout");
			}
		}
	});
});

function topic_delete(tid){
	pid = parseInt(tid);
	
	if (confirm("Sure to delete this topic?"))
	$.ajax({
		type: 'post',
		url:  'index.php',
		data: {'com':'ajaxforum','t':'topic_delete','tid':tid},
		dataType:'json',
		beforeSend: function(){
			$('#topict_delete').attr('disabled','disabled');
		},
		success:function(res){
			if(res.needlogin){
				alert(res.message);
			}else if(!res.success){
				alert(res.message);
			}else{
				alert(res.message);
				window.location.href= homeUrl+'forum-f-'+res.fid+'.html';
			}

		},
		complete: function(){
				$('#topic_delete').removeAttr('disabled');
		}
	});
	
	return false;
	
}

function move_topic(){
	
	var tid = parseInt($('#topic_id').val());
	var target_fid = parseInt($('select[name=target_fid]').val());

	if(!target_fid){
		alert('Please select target forum!');
		return false;
	}
	
	if(confirm('Sure to move this topic?'))
	$.ajax({
		type: 'post',
		url:  'index.php',
		data: {'com':'ajaxforum','t':'moveTopic','tid':tid,'tfid':target_fid},
		dataType:'json',
		beforeSend: function(){
			$('#move_button').attr('disabled','disabled');
		},
		success:function(res){
			closeDiv('move_topic');
			if(res.needlogin){
				alert(res.message);
			}else if(!res.success){
				alert(res.message);
			}else{
				modal_remove();
				alert(res.message);
				window.location.href=homeUrl+'forum-f-'+target_fid+'.html';
			}

		},
		complete: function(){
			$('#move_button').removeAttr('disabled');
		}
	});
}

function post_delete(pid){
	pid = parseInt(pid);
	if (confirm("Sure to delete this post?"))
	$.ajax({
		type: 'post',
		url:  'index.php',
		data: {'com':'ajaxforum','t':'post_delete','pid':pid},
		dataType:'json',
		beforeSend: function(){
			$('#post_delete').attr('disabled','disabled');
		},
		success:function(res){
			if(res.needlogin){
				alert('Please login the forum!');
			}else if(!res.success){
				alert(res.message);
			}else{
				alert(res.message);
				window.location.href=homeUrl+'forum-topic-'+res.tid+'.html';
			}

		},
		complete: function(){
				$('#post_delete').removeAttr('disabled');
		}
	});
	
	return false;
	
}

function move(id){
	var dialogTop =  ($(window).height() - $("#"+id).outerHeight(true))/2 + $(document).scrollTop();
	var dialogLeft = ($(window).width() - $("#"+id).outerWidth(true))/2;
	$("#"+id).css({top:dialogTop, left:dialogLeft}).show();
	
	var maskHeight = $(document).height();
	var maskWidth = $(window).width();
	$('#dialog-overlay').css({height:maskHeight, width:maskWidth}).show();
}


function closeDiv(id){
	$("#"+id).hide();
	$('#dialog-overlay').hide();
}

/* ===========================================================
	异步加载编辑器
 * =========================================================== */

function AjaxEditor(path,elem){
	var $this = $(elem);
	if($this.attr("editload")) return;
	$this.attr("editload","1").attr("disabled","disabled");	
	$.ajax({
		url: "/min/f="+path+"kindeditor-min.js,"+path+"lang/en.js",
		type: "get",
		dataType: "script",
		cache:true,
		success: function(){
					$this.removeAttr("disabled");
					KindEditor.basePath = path;
					editor = KindEditor.create($this,
							{langType:'en',resizeType:2,width:'800px',height:'200px',items:
								[
									'fontname', 'fontsize', 'undo', 'redo', '|', 'forecolor', 'hilitecolor', 'bold','italic', 'underline','removeformat', '|', 
									'image','multiimage','youtube','table', 'hr', 'emoticons','link', 'unlink','|', 'preview','wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
									'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen'
								]
							});
					}
	});
}


$(document).ready(function(){
	var btn_right = $(".in-phone-style").offset().left - $(".to_report_post_btn").outerWidth();
	$(".to_report_post_btn").css('right',btn_right);
});
$(document).on("click",".to_report_post_btn", function(){
	$(this).fadeOut();						
})


function bb(){
	var item_left1 = $(".in-phone-style").offset().left;
	var item_left2 = ( $(".in-phone-style").width() - $(".write_item").width() ) /2;
	var itme_top = ( $(window).outerHeight(true) - $(".in-phone-style .write_item").outerHeight() ) / 2;
	$(".in-phone-style .write_item").css({left: item_left1 + item_left2 + 'px'});
	$(".in-phone-style .write_item").css({top: itme_top + 'px'});
}

bb();


$(".to_write_btn").click(function(){
	$(".write_item").fadeIn();	
});
$(".write_item .close_write_btn").click(function(){
	$(".write_item").fadeOut();						  
});

if(parseInt($(".container:eq(0)").css("width"))<768){
	$('.write_item .topic-post-textarea').attr('onclick','');
	$(document).on("click",".write_item .input-reply,.write_item .topic-post-textarea",function(){
		var o = $(this);
		setTimeout(function(){
			var winHeight = $(window).height();
			var winItem = o.parents(".write_item").outerHeight();
			o.parents(".write_item").css('top',(winHeight-winItem)/2);

		},500);
	});
}


}
/*
     FILE ARCHIVED ON 00:30:00 Aug 31, 2016 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 20:40:51 Oct 06, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 248.229
  exclusion.robots: 0.169
  exclusion.robots.policy: 0.157
  RedisCDXSource: 6.392
  esindex: 0.011
  LoadShardBlock: 211.782 (3)
  PetaboxLoader3.datanode: 592.324 (4)
  CDXLines.iter: 25.99 (3)
  load_resource: 534.464
  PetaboxLoader3.resolve: 71.436
*/